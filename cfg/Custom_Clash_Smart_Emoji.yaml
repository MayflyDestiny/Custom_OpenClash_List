# ========================
# Name: Custom_Clash_Smart_Emoji  
# Designer: MayflyDestiny
# version: v1-20260103
# Date: 2026-01-03
# ========================

# ==================== ä»£ç†æä¾›è€… ====================
# æ³¨æ„ï¼šè¯·æä¾›æ‚¨çš„æœºåœºè®¢é˜…é“¾æ¥ï¼Œå¹¶ä¸ºæ¯ä¸ªæœºåœºå‘½å
proxy-providers:
  è®¢é˜…æºåç§°:
    type: http
    interval: 86400
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
    proxy: "ğŸŸ¢ ç›´è¿"
    url: è®¢é˜…æºåœ°å€

# ==================== æ ¸å¿ƒé…ç½® ====================
# åŸºç¡€é…ç½®
mode: rule
port: 7890
socks-port: 7891
redir-port: 7892
mixed-port: 7893
tproxy-port: 7895
ipv6: true
allow-lan: true
unified-delay: true
tcp-concurrent: true
log-level: warning
bind-address: '*'
find-process-mode: 'always'
global-client-fingerprint: chrome
keep-alive-interval: 15
keep-alive-idle: 600

# ç®¡ç†é¢æ¿é…ç½®
external-ui-url: https://github.com/Zephyruso/zashboard/releases/latest/download/dist.zip
external-ui-name: zashboard
external-ui: ui
external-controller: 127.0.0.1:9090
secret: password  # è¯·ä¿®æ”¹ä¸ºæ‚¨çš„è‡ªå®šä¹‰å¯†ç 

# æ•°æ®åº“é…ç½®
lgbm-auto-update: true
lgbm-url: https://github.com/vernesong/mihomo/releases/download/LightGBM-Model/Model.bin
lgbm-update-interval: 72
profile:
  smart-collector-size: 100.0
  store-selected: true
  store-fake-ip: true
geox-url:
  mmdb: https://testingcf.jsdelivr.net/gh/alecthw/mmdb_china_ip_list@release/Country.mmdb
  geoip: https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geoip.dat
  geosite: https://testingcf.jsdelivr.net/gh/Loyalsoldier/v2ray-rules-dat@release/geosite.dat
  asn: https://testingcf.jsdelivr.net/gh/xishang0128/geoip@release/GeoLite2-ASN.mmdb

# è®¤è¯é…ç½®
authentication:
  - Clash:password  #è®¾ç½® SOCKS5/HTTP(S) è®¤è¯ä¿¡æ¯ï¼šè¯·ä¿®æ”¹ä¸ºæ‚¨çš„è‡ªå®šä¹‰ç”¨æˆ·åå’Œè‡ªå®šä¹‰å¯†ç 
skip-auth-prefixes:
  - 192.168.0.0/16
  - 127.0.0.1/8

# æµé‡å—…æ¢
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "Mijia Cloud"
    - dlg.io.mi.com
    - "+.oray.com"
    - "+.sunlogin.net"
    - "+.push.apple.com"
  force-domain:
    - "+.netflix.com"
    - "+.nflxvideo.net"
    - "+.amazonaws.com"
    - "+.media.dssott.com"
  parse-pure-ip: true  

# TUNæ¨¡å¼é…ç½®
tun:
  enable: false
  stack: mixed
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true

hosts:
  dns.alidns.com: [223.5.5.5, 223.6.6.6, 2400:3200::1, 2400:3200:baba::1]
  doh.pub: [1.12.12.12, 1.12.12.21, 120.53.53.53]
  dns.google: [8.8.8.8, 8.8.4.4, 2001:4860:4860::8888, 2001:4860:4860::8844]
  cloudflare-dns.com: [1.1.1.1, 1.0.0.1, 2606:4700:4700::1111, 2606:4700:4700::1001]
    
# DNSé…ç½®
dns:
  enable: true
  ipv6: true
  use-hosts: true
  enhanced-mode: fake-ip
  listen: 0.0.0.0:9090
  fake-ip-range: 198.18.0.1/16
  fake-ip-range6: fdfe:dcba:9876::1/64
  fake-ip-filter-mode: blacklist
  respect-rules: false
  nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
  fake-ip-filter:
  - rule-set:Fakeip-Filter
  - geosite:cn
  - geosite:category-games
  - geosite:apple-cn
  - geosite:google-cn

# ==================== è¿æ¥é…ç½® ====================
proxies:
- name: "ğŸŸ¢ ç›´è¿"
  type: direct
  udp: true
- name: "â›” æ‹’ç»"
  type: reject
  udp: true

# ========================
# ç­–ç•¥ç»„å®šä¹‰
# ========================
pr: &pr {type: select, proxies: [ğŸŸ¢ ç›´è¿, ğŸš€ åˆ†ç»„é€‰æ‹©, ğŸ”¯ é¦™æ¸¯-æ•…è½¬, ğŸ”¯ å°æ¹¾-æ•…è½¬, ğŸ”¯ æ—¥æœ¬-æ•…è½¬, ğŸ”¯ ç¾å›½-æ•…è½¬, â™»ï¸ é¦™æ¸¯-æ™ºé€‰, â™»ï¸ å°æ¹¾-æ™ºé€‰, â™»ï¸ æ—¥æœ¬-æ™ºé€‰, â™»ï¸ ç¾å›½-æ™ºé€‰, â™»ï¸ æ‰€æœ‰-æ™ºé€‰, ğŸ‡­ğŸ‡° é¦™æ¸¯-æ‰‹é€‰, ğŸ‡¹ğŸ‡¼ å°æ¹¾-æ‰‹é€‰, ğŸ‡¯ğŸ‡µ æ—¥æœ¬-æ‰‹é€‰, ğŸ‡ºğŸ‡² ç¾å›½-æ‰‹é€‰, ğŸŒ æ‰€æœ‰-èŠ‚ç‚¹]}

proxy-groups:
  - {name: ğŸš€ åˆ†ç»„é€‰æ‹©, type: select, proxies: [ğŸ”¯ é¦™æ¸¯-æ•…è½¬, ğŸ”¯ å°æ¹¾-æ•…è½¬, ğŸ”¯ æ—¥æœ¬-æ•…è½¬, ğŸ”¯ ç¾å›½-æ•…è½¬, â™»ï¸ é¦™æ¸¯-æ™ºé€‰, â™»ï¸ å°æ¹¾-æ™ºé€‰, â™»ï¸ æ—¥æœ¬-æ™ºé€‰, â™»ï¸ ç¾å›½-æ™ºé€‰, â™»ï¸ æ‰€æœ‰-æ™ºé€‰, ğŸ‡­ğŸ‡° é¦™æ¸¯-æ‰‹é€‰, ğŸ‡¹ğŸ‡¼ å°æ¹¾-æ‰‹é€‰, ğŸ‡¯ğŸ‡µ æ—¥æœ¬-æ‰‹é€‰, ğŸ‡ºğŸ‡² ç¾å›½-æ‰‹é€‰, ğŸŒ æ‰€æœ‰-èŠ‚ç‚¹]}

  - {name: ğŸ® Games,<<: *pr}
  - {name: ğŸ¤– ChatAI, <<: *pr}
  - {name: ğŸ‘¨ğŸ¿â€ğŸ’» GitHub, <<: *pr}
  - {name: ğŸ§² PTSite, <<: *pr}
  - {name: ğŸ’¬ Social, <<: *pr}
  - {name: ğŸ¶ TikTok, <<: *pr}
  - {name: ğŸ“º Stream, <<: *pr}
  - {name: ğŸªŸ Microsoft, <<: *pr}
  - {name: â˜ï¸ Cloudflare, <<: *pr}
  - {name: ğŸ›’ å›½å¤–ç”µå•†, <<: *pr}
  - {name: â±ï¸ ç½‘ç»œæ£€æµ‹, <<: *pr}
  - {name: ğŸ’« å…¨çƒç›´è¿, <<: *pr}
  - {name: ğŸŸ æ¼ç½‘ä¹‹é±¼, <<: *pr}
  
# ========================
# æ‰‹é€‰åˆ†ç»„ï¼ˆselectï¼‰
# ========================
  - {name: ğŸ‡­ğŸ‡° é¦™æ¸¯-æ‰‹é€‰, type: select, include-all: true, filter: "(?=.*(é¦™æ¸¯|HK|Hong Kong|ğŸ‡­ğŸ‡°|HongKong)).*$"}
  - {name: ğŸ‡¹ğŸ‡¼ å°æ¹¾-æ‰‹é€‰, type: select, include-all: true, filter: "(?=.*(å°æ¹¾|å°ç£|TW|Tai Wan|ğŸ‡¹ğŸ‡¼|ğŸ‡¨ğŸ‡³|TaiWan|Taiwan)).*$"}
  - {name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬-æ‰‹é€‰, type: select, include-all: true, filter: "(?=.*(æ—¥æœ¬|JP|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|æ²ªæ—¥|æ·±æ—¥|ğŸ‡¯ğŸ‡µ|Japan)).*$"}
  - {name: ğŸ‡ºğŸ‡² ç¾å›½-æ‰‹é€‰, type: select, include-all: true, filter: "(?=.*(ç¾|US|çº½çº¦|è¾¾æ‹‰æ–¯|ä¿„å‹’|å‡¤å‡°åŸ|è´¹åˆ©è’™|æ‹‰æ–¯|æ´›æ‰|åœ£ä½•å¡|åœ£å…‹æ‹‰|è¥¿é›…|èŠåŠ |ğŸ‡ºğŸ‡¸|United States)).*$"}
  
# ========================
# æ•…è½¬åˆ†ç»„ï¼ˆfallbackï¼‰
# ========================
  - {name: ğŸ”¯ é¦™æ¸¯-æ•…è½¬, type: fallback, interval: 180, lazy: false, proxies: [ğŸ‡­ğŸ‡° é¦™æ¸¯-æ‰‹é€‰, â™»ï¸ é¦™æ¸¯-æ™ºé€‰]}
  - {name: ğŸ”¯ å°æ¹¾-æ•…è½¬, type: fallback, interval: 180, lazy: false, proxies: [ğŸ‡¹ğŸ‡¼ å°æ¹¾-æ‰‹é€‰, â™»ï¸ å°æ¹¾-æ™ºé€‰]}
  - {name: ğŸ”¯ æ—¥æœ¬-æ•…è½¬, type: fallback, interval: 180, lazy: false, proxies: [ğŸ‡¯ğŸ‡µ æ—¥æœ¬-æ‰‹é€‰, â™»ï¸ æ—¥æœ¬-æ™ºé€‰]}
  - {name: ğŸ”¯ ç¾å›½-æ•…è½¬, type: fallback, interval: 180, lazy: false, proxies: [ğŸ‡ºğŸ‡² ç¾å›½-æ‰‹é€‰, â™»ï¸ ç¾å›½-æ™ºé€‰]}

# ========================
# æ™ºé€‰åˆ†ç»„ï¼ˆsmartï¼‰
# ========================
  - name: â™»ï¸ é¦™æ¸¯-æ™ºé€‰
    type: smart
    include-all: true
    policy-priority: ".*çº¢æ.*:0.8;.*(è´Ÿè½½|è”é€š).*:1.2"
    uselightgbm: true
    collectdata: true
    health-check: 
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 60
      tolerance: 2
    strategy: sticky-sessions
    interval: 180
    filter: "(?=.*(å¹¿æ¸¯|é¦™æ¸¯|HK|Hong Kong|ğŸ‡­ğŸ‡°|HongKong)).*$"
 
  - name: â™»ï¸ å°æ¹¾-æ™ºé€‰
    type: smart
    include-all: true
    policy-priority: ".*çº¢æ.*:0.8;.*(è´Ÿè½½|è”é€š).*:1.2"
    uselightgbm: true
    collectdata: true
    health-check: 
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 60
      tolerance: 2
    strategy: sticky-sessions
    interval: 180
    filter: "(?=.*(å°æ¹¾|å°ç£|TW|Tai Wan|ğŸ‡¹ğŸ‡¼|ğŸ‡¨ğŸ‡³|TaiWan|Taiwan)).*$"

  - name: â™»ï¸ æ—¥æœ¬-æ™ºé€‰
    type: smart
    include-all: true
    policy-priority: ".*çº¢æ.*:0.8;.*(è´Ÿè½½|è”é€š).*:1.2"
    uselightgbm: true
    collectdata: true
    health-check: 
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 60
      tolerance: 2
    strategy: sticky-sessions
    interval: 180
    filter: "(?=.*(æ—¥æœ¬|JP|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|æ²ªæ—¥|æ·±æ—¥|ğŸ‡¯ğŸ‡µ|Japan)).*$"

  - name: â™»ï¸ ç¾å›½-æ™ºé€‰
    type: smart
    include-all: true
    policy-priority: ".*çº¢æ.*:0.8;.*(è´Ÿè½½|è”é€š).*:1.2"
    uselightgbm: true
    collectdata: true
    health-check: 
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 60
      tolerance: 2
    strategy: sticky-sessions
    interval: 180
    filter: "(?=.*(ç¾|US|çº½çº¦|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’|å‡¤å‡°åŸ|è´¹åˆ©è’™|æ‹‰æ–¯|æ´›æ‰|åœ£ä½•å¡|åœ£å…‹æ‹‰|è¥¿é›…|èŠåŠ |ğŸ‡ºğŸ‡¸|United States)).*$"

  - name: â™»ï¸ æ‰€æœ‰-æ™ºé€‰
    type: smart
    include-all: true
    policy-priority: ".*çº¢æ.*:0.8;.*(è´Ÿè½½|è”é€š).*:1.2"
    uselightgbm: true
    collectdata: true
    health-check: 
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 60
      tolerance: 2
    strategy: sticky-sessions
    interval: 180
    filter: "^((?!(ç›´è¿|æ‹’ç»|å‰©ä½™|å¥—é¤)).)*$"

# ========================
# æ‰€æœ‰èŠ‚ç‚¹ï¼ˆallï¼‰
# ========================
  - {name: ğŸŒ æ‰€æœ‰-èŠ‚ç‚¹, type: select, include-all: true, filter: "^((?!(ç›´è¿|æ‹’ç»|å‰©ä½™|å¥—é¤)).)*$"}

# ========================
# è§„åˆ™å¼•æ“ï¼ˆrulesï¼‰
# ========================
rules:
  
  # =======èŠ‚ç‚¹è§„åˆ™é›†=======
  - DOMAIN-SUFFIX,jp,ğŸ”¯ æ—¥æœ¬-æ•…è½¬
  
  # =======ä¼˜å…ˆè§„åˆ™é›†=======
  - GEOIP,private,ğŸ’« å…¨çƒç›´è¿,no-resolve
  - GEOSITE,private,ğŸ’« å…¨çƒç›´è¿
  - GEOSITE,steam@cn,ğŸ’« å…¨çƒç›´è¿
  - GEOSITE,google-cn,ğŸ’« å…¨çƒç›´è¿
  - GEOSITE,microsoft@cn,ğŸ’« å…¨çƒç›´è¿
  - GEOSITE,cloudflare@cn,ğŸ’« å…¨çƒç›´è¿
  - GEOSITE,category-games@cn,ğŸ’« å…¨çƒç›´è¿
  - GEOSITE,category-ecommerce@cn,ğŸ’« å…¨çƒç›´è¿
  - GEOSITE,category-speedtest@cn,ğŸ’« å…¨çƒç›´è¿
  - GEOSITE,category-public-tracker,ğŸ’« å…¨çƒç›´è¿
  - GEOSITE,category-game-platforms-download,ğŸ’« å…¨çƒç›´è¿
  - RULE-SET,Custom_Direct_Domain,ğŸ’« å…¨çƒç›´è¿
  - RULE-SET,Mayfly_Custom_Direct,ğŸ’« å…¨çƒç›´è¿
  - RULE-SET,Custom_Proxy_Domain,ğŸš€ åˆ†ç»„é€‰æ‹©
  - RULE-SET,Mayfly_Custom_Proxy,ğŸš€ åˆ†ç»„é€‰æ‹©
  
  # =======æ¸¸æˆè§„åˆ™é›†=======
  - GEOSITE,steam,ğŸ® Games
  - GEOSITE,category-games,ğŸ® Games
  
  # =======AIè§„åˆ™é›†=======
  - GEOSITE,category-ai-!cn,ğŸ¤– ChatAI
  
  # =======Githubè§„åˆ™é›†=======
  - GEOSITE,github,ğŸ‘¨ğŸ¿â€ğŸ’» GitHub
  
  # =======PTè§„åˆ™é›†=======
  - GEOSITE,category-pt,ğŸ§² PTSite
  
  # =======ç¤¾äº¤è§„åˆ™é›†=======
  - GEOIP,twitter,ğŸ’¬ Social,no-resolve
  - GEOIP,telegram,ğŸ’¬ Social,no-resolve
  - GEOIP,facebook,ğŸ’¬ Social,no-resolve
  - GEOSITE,x,ğŸ’¬ Social
  - GEOSITE,twitter,ğŸ’¬ Social
  - GEOSITE,telegram,ğŸ’¬ Social
  - GEOSITE,category-communication,ğŸ’¬ Social
  - GEOSITE,category-social-media-!cn,ğŸ’¬ Social
  
  # =======TikTokè§„åˆ™é›†=======
  - GEOSITE,tiktok,ğŸ¶ TikTok
  
  # =======å½±éŸ³è§„åˆ™é›†=======
  - GEOIP,netflix,ğŸ“º Stream,no-resolve
  - GEOSITE,okx,ğŸ“º Stream
  - GEOSITE,hbo,ğŸ“º Stream
  - GEOSITE,bybit,ğŸ“º Stream
  - GEOSITE,amazon,ğŸ“º Stream
  - GEOSITE,disney,ğŸ“º Stream
  - GEOSITE,netflix,ğŸ“º Stream
  - GEOSITE,binance,ğŸ“º Stream
  - GEOSITE,youtube,ğŸ“º Stream
  - GEOSITE,spotify,ğŸ“º Stream
  - GEOSITE,category-entertainment,ğŸ“º Stream
  - RULE-SET,GlobalMedia,ğŸ“º Stream
  
  # =======å¾®è½¯è§„åˆ™é›†=======
  - GEOSITE,onedrive,ğŸªŸ Microsoft
  - GEOSITE,microsoft,ğŸªŸ Microsoft
  
  # =======Cloudflareè§„åˆ™é›†=======
  - GEOSITE,cloudflare,â˜ï¸ Cloudflare
  
  # =======è´­ç‰©è§„åˆ™é›†=======
  - GEOSITE,category-ecommerce,ğŸ›’ å›½å¤–ç”µå•†
  
  # =======ç½‘ç»œæ£€æµ‹è§„åˆ™é›†=======
  - RULE-SET,Mayfly_Custom_Check,â±ï¸ ç½‘ç»œæ£€æµ‹
  - GEOSITE,category-speedtest,â±ï¸ ç½‘ç»œæ£€æµ‹
  
  # =======å…œåº•è§„åˆ™é›†=======
  - GEOIP,google,ğŸš€ åˆ†ç»„é€‰æ‹©,no-resolve
  - GEOSITE,gfw,ğŸš€ åˆ†ç»„é€‰æ‹©
  - GEOSITE,google,ğŸš€ åˆ†ç»„é€‰æ‹©
  - GEOSITE,geolocation-!cn,ğŸš€ åˆ†ç»„é€‰æ‹©
  - GEOSITE,category-scholar-!cn,ğŸš€ åˆ†ç»„é€‰æ‹©
  - GEOSITE,category-companies,ğŸš€ åˆ†ç»„é€‰æ‹©
  - GEOSITE,cn,ğŸ’« å…¨çƒç›´è¿
  - GEOIP,cn,ğŸ’« å…¨çƒç›´è¿,no-resolve
  - GEOSITE,Global,ğŸš€ åˆ†ç»„é€‰æ‹©
  - RULE-SET,ChinaMax,ğŸ’« å…¨çƒç›´è¿
  - RULE-SET,China-ASN-combined,ğŸ’« å…¨çƒç›´è¿,no-resolve
  
  # =======å€™è¡¥è§„åˆ™é›†=======
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼

# ========================
# è¡¥å……è§„åˆ™é›†
# ========================
rule-anchor:
  ## typeï¼šå¯é€‰http/file/inline  behaviorï¼šå¯é€‰domain/ipcidr/classical formatï¼šå¯é€‰yaml/text/mrs
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: mrs}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: mrs}
  class: &class {type: http, interval: 86400, behavior: classical, format: text}
  yaml: &yaml {type: http, interval: 86400, behavior: classical, format: yaml}

rule-providers:
  # ForestL18è§„åˆ™
  China-ASN-combined: {<<: *ip, url: "https://raw.githubusercontent.com/qljsyph/ruleset-icon/refs/heads/main/mihomo/ipcidr/China-ASN-combined.mrs"}

  # Aethersailorè§„åˆ™
  Custom_Direct_Domain: {<<: *domain, url: "https://raw.githubusercontent.com/Aethersailor/Custom_OpenClash_Rules/refs/heads/main/rule/Custom_Direct_Domain.mrs"}
  Custom_Proxy_Domain: {<<: *domain, url: "https://raw.githubusercontent.com/Aethersailor/Custom_OpenClash_Rules/refs/heads/main/rule/Custom_Proxy_Domain.mrs"}

  # blackmatrix7è§„åˆ™
  Global: {<<: *class, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/Global/Global.list"}
  ChinaMax: {<<: *class, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/ChinaMax/ChinaMax.list"}
  GlobalMedia: {<<: *class, url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/GlobalMedia/GlobalMedia.list"}

  #è‡ªç”¨è§„åˆ™
  Mayfly_Custom_Direct: {<<: *domain, url: "https://raw.githubusercontent.com/MayflyDestiny/Custom_OpenClash_Rules/refs/heads/main/rule/Custom_Direct.mrs"}
  Mayfly_Custom_Check: {<<: *domain, url: "https://raw.githubusercontent.com/MayflyDestiny/Custom_OpenClash_Rules/refs/heads/main/rule/Custom_Check.mrs"}
  Mayfly_Custom_Proxy: {<<: *domain, url: "https://raw.githubusercontent.com/MayflyDestiny/Custom_OpenClash_Rules/refs/heads/main/rule/Custom_Proxy.mrs"}

  # Fakeip-Filter
  Fakeip-Filter: {<<: *domain, url: "https://raw.githubusercontent.com/MayflyDestiny/Custom_OpenClash_Rules/refs/heads/main/rule/Fakeip-Filter.mrs"}